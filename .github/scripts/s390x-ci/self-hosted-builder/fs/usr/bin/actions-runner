#!/bin/bash

set -e -u

# first import docker image
if [ -f ./manywheel-s390x.tar ] ; then
	docker image load --input manywheel-s390x.tar
	docker image tag docker.io/pytorch/manylinuxs390x-builder:cpu-s390x docker.io/pytorch/manylinuxs390x-builder:cpu-s390x-main
	/bin/rm manywheel-s390x.tar
fi

# enter into python virtual environment.
# build workflows use "python -m pip install ...",
# and it doesn't work for non-root user
source venv/bin/activate

# Run one job.
./run.sh --once
